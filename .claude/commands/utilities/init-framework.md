---
description: Interactive setup wizard for configuring the Scout-Plan-Build framework in a new or existing project.
argument-hint: (no arguments - interactive)
---

<!-- risk: mutate-local -->
<!-- auto-invoke: gated -->

# Initialize Scout-Plan-Build Framework

Interactive setup wizard for configuring the Scout-Plan-Build framework in a new or existing project.

## Overview

This command guides you through framework configuration using interactive questions, then creates the necessary directory structure, configuration files, and gitignore patterns based on your preferences.

---

## Step 1: Gather Configuration via Interactive Questions

Use the AskUserQuestion tool to collect user preferences. Ask all 4 questions in a single call:

```json
{
  "questions": [
    {
      "question": "What type of project is this?",
      "header": "Project Type",
      "options": [
        {"label": "New project", "description": "Start fresh with full framework directory structure"},
        {"label": "Existing codebase", "description": "Add framework to existing code, preserve current structure"},
        {"label": "Fork/clone", "description": "Forked repo - minimal changes, respect upstream patterns"}
      ],
      "multiSelect": false
    },
    {
      "question": "Which workflow style do you prefer?",
      "header": "Workflow",
      "options": [
        {"label": "Full ADW", "description": "Complete scout -> plan -> build pipeline with validation gates"},
        {"label": "Quick mode", "description": "Streamlined plan -> build (skip scout for simpler tasks)"},
        {"label": "Manual", "description": "No automatic routing - invoke commands explicitly"}
      ],
      "multiSelect": false
    },
    {
      "question": "What git branching strategy should be used?",
      "header": "Git Strategy",
      "options": [
        {"label": "Feature branches", "description": "Create feature/issue-XXX branches for each task"},
        {"label": "Trunk-based", "description": "Short-lived branches, frequent merges to main"},
        {"label": "Worktrees", "description": "Use git worktrees for parallel experimentation"}
      ],
      "multiSelect": false
    },
    {
      "question": "How should framework outputs be organized?",
      "header": "Output Paths",
      "options": [
        {"label": "Standard", "description": "Use ai_docs/, specs/, scout_outputs/ (recommended)"},
        {"label": "Minimal", "description": "Only specs/ and .claude/ directories"},
        {"label": "Custom", "description": "I'll specify custom paths after setup"}
      ],
      "multiSelect": false
    }
  ]
}
```

### AskUserQuestion Bug Workaround

**IMPORTANT**: If AskUserQuestion returns instantly without showing questions to the user (known bug in some permission bypass modes), fall back to these sensible defaults:

| Setting | Default Value | Rationale |
|---------|---------------|-----------|
| Project Type | "Existing codebase" | Safest - doesn't overwrite anything |
| Workflow | "Full ADW" | Most comprehensive |
| Git Strategy | "Feature branches" | Most common, safest |
| Output Paths | "Standard" | Matches CLAUDE.md documentation |

If using defaults, inform the user:
```
Note: Using default configuration (AskUserQuestion may have been bypassed).
Defaults: Existing codebase, Full ADW workflow, Feature branches, Standard paths.
Run `/init-framework` again interactively to customize.
```

---

## Step 2: Create Directory Structure

Based on the answers, create the appropriate directories.

### For "Standard" or "Full ADW" Output Paths:

```bash
# Core framework directories
mkdir -p specs/
mkdir -p scout_outputs/
mkdir -p scout_outputs/temp/
mkdir -p scout_outputs/workflows/
mkdir -p ai_docs/
mkdir -p ai_docs/build_reports/
mkdir -p ai_docs/reviews/
mkdir -p ai_docs/analyses/
mkdir -p ai_docs/research/
mkdir -p ai_docs/outputs/

# Claude configuration directories
mkdir -p .claude/commands/
mkdir -p .claude/memory/
mkdir -p .claude/state/

# Agent outputs (timestamped, gitignored)
mkdir -p agent_outputs/
```

### For "Minimal" Output Paths:

```bash
mkdir -p specs/
mkdir -p .claude/commands/
mkdir -p .claude/memory/
```

### For "Worktrees" Git Strategy (additional):

```bash
mkdir -p trees/
```

### Create .gitkeep files:

For each created directory, add a `.gitkeep` file to preserve empty directories:

```bash
touch specs/.gitkeep
touch scout_outputs/.gitkeep
# etc.
```

---

## Step 3: Generate Configuration File

Create `.scout_framework.yaml` with user preferences:

```yaml
# Scout-Plan-Build Framework Configuration
# Generated by /init-framework on [CURRENT_DATE]
# Version: 1.0.0

framework:
  version: "1.0.0"
  initialized: "[CURRENT_TIMESTAMP]"

project:
  type: "[ANSWER_1]"  # new_project | existing_codebase | fork_clone
  name: "[REPO_NAME or directory name]"

workflow:
  mode: "[ANSWER_2]"  # full_adw | quick_mode | manual
  auto_scout: [true if Full ADW, false otherwise]
  validation_gates: [true if Full ADW, false otherwise]

  # Command routing based on workflow mode
  routing:
    # Full ADW: scout -> plan -> build with validation
    # Quick mode: plan -> build (skip scout)
    # Manual: no automatic routing
    default_pipeline: "[full | quick | manual]"

git:
  strategy: "[ANSWER_3]"  # feature_branches | trunk_based | worktrees
  branch_prefix: "[feature/ for feature_branches, '' for trunk, experiment/ for worktrees]"
  auto_branch: [true for feature_branches, false otherwise]
  worktree_base: "trees/"  # Only if worktrees selected

paths:
  output_style: "[ANSWER_4]"  # standard | minimal | custom
  specs: "specs/"
  scout_outputs: "[scout_outputs/ for standard, .claude/scout/ for minimal]"
  ai_docs: "[ai_docs/ for standard, null for minimal]"
  build_reports: "[ai_docs/build_reports/ for standard, specs/reports/ for minimal]"
  agent_outputs: "agent_outputs/"

  # Allowed write paths (safety constraint)
  allowed_write_paths:
    - "specs/"
    - "scout_outputs/"
    - "ai_docs/"
    - "agent_outputs/"
    - ".claude/"
    - "trees/"

safety:
  require_feature_branch: [true unless trunk_based]
  prevent_root_writes: true
  auto_gitignore: true

# User can add custom overrides below this line
custom: {}
```

---

## Step 4: Update .gitignore

Append framework-specific patterns to `.gitignore` (create if doesn't exist):

```gitignore
# ============================================
# Scout-Plan-Build Framework (auto-generated)
# ============================================

# Agent outputs (timestamped working directories)
/agent_outputs/*/
!/agent_outputs/.gitkeep

# Scout temporary files
/scout_outputs/temp/
!/scout_outputs/temp/.gitkeep

# Worktree directories (if using worktrees strategy)
/trees/

# Framework state (session-specific)
.claude/state/
.claude/memory/*.tmp

# Build artifacts and reports that shouldn't be committed
/*_REPORT.md
/*_ANALYSIS.md
/*_AUDIT.md
/*_SUMMARY.md
/CLAUDE_v*.md

# Environment and secrets
.env
.env.local
.env.*.local

# IDE and OS
.DS_Store
.vscode/
.idea/
*.swp
*.swo

# Python
__pycache__/
*.pyc
*.pyo
.pytest_cache/
.venv/
venv/

# Node (if applicable)
node_modules/
.npm/
```

**Note**: Only add patterns that don't already exist in `.gitignore`.

---

## Step 5: Create ADW Config

Generate `.adw_config.json` for runtime configuration:

```json
{
  "version": "1.0.0",
  "project": {
    "name": "[REPO_NAME]",
    "type": "[ANSWER_1]",
    "initialized": "[TIMESTAMP]"
  },
  "workflow": {
    "mode": "[ANSWER_2]",
    "auto_scout": [boolean],
    "use_github": true,
    "auto_branch": [boolean based on ANSWER_3]
  },
  "paths": {
    "specs": "specs/",
    "scout_outputs": "scout_outputs/",
    "ai_docs": "ai_docs/",
    "allowed": ["specs", "scout_outputs", "ai_docs", "agent_outputs", ".claude", "trees"]
  },
  "git": {
    "strategy": "[ANSWER_3]",
    "branch_prefix": "[prefix based on strategy]"
  }
}
```

---

## Step 6: Validate and Report

### Validation Checks

Run these validation checks and report results:

| Check | Command | Required |
|-------|---------|----------|
| Git repository | `git rev-parse --git-dir` | Yes |
| Python available | `python --version` | Yes |
| Specs directory | `test -d specs/` | Yes |
| Config file | `test -f .scout_framework.yaml` | Yes |
| Gitignore updated | `grep -q "Scout-Plan-Build" .gitignore` | Yes |

### Summary Report

Output a summary of what was configured:

```markdown
## Framework Initialization Complete

### Configuration Summary

| Setting | Value |
|---------|-------|
| Project Type | [Answer 1] |
| Workflow Mode | [Answer 2] |
| Git Strategy | [Answer 3] |
| Output Organization | [Answer 4] |

### Directories Created

- specs/ - Implementation plans and specifications
- scout_outputs/ - Discovery results
- ai_docs/ - Build reports, reviews, analyses
- .claude/commands/ - Slash commands
- .claude/memory/ - Workflow memory
[List all created directories]

### Files Generated

- .scout_framework.yaml - Framework configuration
- .adw_config.json - Runtime configuration
- .gitignore - Updated with framework patterns

### Next Steps

1. Review generated configuration:
   - `.scout_framework.yaml` for framework settings
   - `.adw_config.json` for runtime behavior

2. Set required environment variables:
   ```bash
   export CLAUDE_CODE_MAX_OUTPUT_TOKENS=32768
   export ANTHROPIC_API_KEY="your-key"
   ```

3. Start your first workflow:
   - **Full ADW**: `/scout_improved "task description"` -> `/plan_w_docs_improved` -> `/build_adw`
   - **Quick mode**: `/plan_w_docs_improved "task" "" "files.json"` -> `/build_adw`
   - **Manual**: Use individual commands as needed

4. [If feature branches] Create a feature branch before making changes:
   ```bash
   git checkout -b feature/your-feature-name
   ```

5. [If worktrees] Initialize parallel worktrees for experimentation:
   ```bash
   /init-parallel-worktrees experiment-name 3
   ```
```

---

## Configuration Presets Reference

### New Project Preset
- Creates all directories including `src/`, `tests/`
- Full validation gates enabled
- Strict output path enforcement

### Existing Codebase Preset
- Only adds framework directories, preserves existing structure
- Moderate validation (warns but doesn't block)
- Flexible path handling

### Fork/Clone Preset
- Minimal additions (only `.claude/` and `specs/`)
- Respects upstream `.gitignore`
- Manual workflow by default

---

## Troubleshooting

### "AskUserQuestion returned no answers"
The tool may have been bypassed. Defaults were applied. Re-run with:
```
/init-framework
```
And ensure you're in an interactive terminal session.

### "Directory already exists"
Framework may already be initialized. Check `.scout_framework.yaml`:
```bash
cat .scout_framework.yaml
```
To reinitialize, delete the config and re-run:
```bash
rm .scout_framework.yaml && /init-framework
```

### "Not a git repository"
Initialize git first:
```bash
git init
git add .
git commit -m "Initial commit"
```
